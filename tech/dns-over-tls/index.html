<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=darkreader-lock><title>DNS Over TLS to Prevent ISP From Blocking Websites - tifan.me</title><meta name=description content="Encrypt DNS queries for a more free internet ðŸ”“"><meta name=author content="Tifan Dwi Avianto"><link rel=stylesheet href=https://tifan.me/style.min.62776f1281a0011526ac68c910483e97ba01cf35856937749983d0a0219c7ed2.css type=text/css media=all><link rel=stylesheet href=https://tifan.me/syntax-highlighting.min.46dabb2f5d159e515f3501593dbdc1d89ac095a7b1b710b90795dbf13d30aa68.css type=text/css media=all><link rel=icon type=image/png href=/favicon.png><script data-host=https://microanalytics.io data-dnt=false src=https://microanalytics.io/js/script.js id=ZwSg9rf6GA async defer></script></head><body><nav class=back-nav><a href=/tech/><svg stroke="currentcolor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg><span>Tech</span></a></nav><article><header class=single><h1 class="bare fluid">DNS Over TLS to Prevent ISP From Blocking Websites</h1><h3 aria-hidden=true>Encrypt DNS queries for a more free internet ðŸ”“</h3><h4 aria-hidden=true>Published: Nov 14, 2022 / <span style=white-space:nowrap>Modified: Nov 14, 2022</span></h4><p aria-hidden=true style="margin:1em 0 0"><a href=https://tifan.me/tech/tags/linux/>#linux</a>&nbsp;&nbsp;</p></header><h1 id=dns-over-tls>DNS Over TLS</h1><p>Definition from
<a href=https://www.cloudflare.com/learning/dns/dns-over-tls/ target=_blank>Cloudflare</a>:</p><blockquote><p>DNS over TLS, or DoT, is a standard for encrypting DNS queries to keep them secure and private. DoT uses the same security protocol, TLS, that HTTPS websites use to encrypt and authenticate communications. DoT adds TLS encryption on top of the user datagram protocol (UDP), which is used for DNS queries.</p></blockquote><h2 id=systemd-resolved>systemd-resolved</h2><p>If you are using Linux OSs with systemd, using this service will allow us to use DNS over TLS on our system.</p><p>Here&rsquo;s my config files for <code>/etc/systemd/resolved.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl><span class=nv>DNS</span><span class=o>=</span>1.1.1.1#cloudflare-dns.com 1.0.0.1#cloudflare-dns.com 606:4700:4700::1111#cloudflare-dns.com 2606:4700:4700::1001#cloudflare-dns.com
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nv>FallbackDNS</span><span class=o>=</span>9.9.9.9#quad9.net 149.112.112.112#quad9.net 2620:fe::fe#quad9.net 2620:fe::9#quad9.net
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=nv>Domains</span><span class=o>=</span>~.
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=nv>DNSSEC</span><span class=o>=</span>yes
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=nv>DNSOverTLS</span><span class=o>=</span>yes
</span></span></code></pre></div><blockquote><p>Personally I use cloudflare with quad9 as fallback. You can pick and choose how you want.</p></blockquote><p>To restart the services, run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl>sudo systemctl restart systemd-resolved
</span></span><span class=line><span class=ln>2</span><span class=cl>sudo systemctl restart NetworkManager
</span></span></code></pre></div><p>Check status</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl>resolvectl status
</span></span></code></pre></div><p>Test connection at
<a href=https://1.1.1.1/help target=_blank>https://1.1.1.1/help</a></p><h1 id=dns-over-https>DNS over HTTPS</h1><p>Basically the difference is, instead of encrypting DNS queries directly over UDP, <abbr title="DNS over HTTPS">DoH</abbr> encrypt from the HTTP or HTTP/2 protocol. Most major browsers actually have this feature built-in. On firefox:</p><figure><img src=browser.png alt="DNS over HTTP on browser"></figure><p>However, by using DNS over TLS with systemd-resolved, we are encrypting our DNS queries system-wide, rather than only the browser.</p><h1 id=references>References</h1><ul><li><a href=https://medium.com/@jawadalkassim/enable-dns-over-tls-in-linux-using-systemd-b03e44448c1c target=_blank>https://medium.com/@jawadalkassim/enable-dns-over-tls-in-linux-using-systemd-b03e44448c1c</a></li><li><a href=https://dns.sb/guide/dot/linux/#debian-and-most-popular-linux-distributions target=_blank>https://dns.sb/guide/dot/linux/#debian-and-most-popular-linux-distributions</a></li><li><a href=https://www.cloudflare.com/learning/dns/dns-over-tls/ target=_blank>https://www.cloudflare.com/learning/dns/dns-over-tls/</a></li></ul></article><footer><a href=https://github.com/tifandotme/tifan.me/edit/main/content/tech/dns-over-tls/index.md style=align-self:flex-end;padding:0 target=_blank>Edit post</a>
<a href=https://tifan.me/>Home</a></footer></body></html>